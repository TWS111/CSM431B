# CSM431B应用层移植说明

## 文件需求

`CSM431B.c`和`CSM431B.h`置于相应位置，同时将LICENSE文件置于同一文件夹下（MIT许可证，用于标记版权）。

移入任何DSP工程时，不需要`DEBUG.h`文件。

## 调试宏定义

移入任何DSP工程时，将`#define _debug`注释；将`#define _release`解除注释。

进行无固定应答从机调试时，将`#define _noSlaveDebug`解除注释；

进行具有固定应答从机的调试时，将`#define _noSlaveDebug`注释；

## 外设需求

| 外设          | GPIO                   | 方向/功能 |
| ------------- | ---------------------- | --------- |
| SPI           | GPIO56                 | SPIA-CLK  |
| SPI           | GPIO16                 | SPIA-MOSI |
| SPI           | GPIO17                 | SPIA-MISO |
| IO-XINT       | GPIO7                  | I-XINT    |
| IO            | GPIO57、GPIO58、GPIO40 | O         |
| I2C（未启用） | GPIO26                 | I2CA-SDA  |
| I2C（未启用） | GPIO27                 | I2CA-SCL  |

## 事件

| 位置       | 名                              | 执行周期 |
| ---------- | ------------------------------- | -------- |
| while(1)内 | `IdelEvent(uint16_t sendData);` | --       |
| 主中断内   | `TimeInterval(void);`           | 25KHz    |
| 主中断内   | `SendCommand(void);`            | 50Hz     |
| 外部中断内 | `ReceiveCommand(void);`         | 被动触发 |

## 数据获取

发送数据时，对函数`IdelEvent(uint16_t sendData);`的形参（**`sendData`为数组指针**，其中数组数据空间不小于32）所对应的数组进行填充；其中发送函数未根据上层协议进行帧头的填充。

调用接收的数据时，调用函数进行数组指针的获取以获取接收值。

**上述项可更改为操作结构体实现，具体内容待对接。**

## 典型时间

| 事件                                                         | 典型值 |
| ------------------------------------------------------------ | ------ |
| 一帧32字节CANFD帧由开始SPI发送至接收节点完全接收             | 431us  |
| 具有查询总线故障的轮次发送帧（发送-查询-读取）的行为完整时间 | 1.71ms |
| 一帧64字节CANFD帧接收自INT开始拉低响应至完整读取完毕时间     | 975us  |
| 查询总线故障时间间隔                                         | 60ms   |
| 自上电开始进行CSM431B初始化至配置完成写入的时间              | 426ms  |
| 自上电开始进行CSM431B初始化至进入工作模式的时间              | 536ms  |

